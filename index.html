<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–æ–Ω—Ç—É—Ä–Ω–∞—è –∫–∞—Ä—Ç–∞ –ï–≤—Ä–æ–ø—ã | EuroContour</title>
    <meta name="description" content="–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —É—á–µ–±–Ω–∞—è –∫–∞—Ä—Ç–∞ –ï–≤—Ä–æ–ø—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω –∏ —Å—Ç–æ–ª–∏—Ü">
    <meta property="og:title" content="EuroContour - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –ï–≤—Ä–æ–ø—ã">
    <meta property="og:description" content="–£—á–µ–±–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –µ–≤—Ä–æ–ø–µ–π—Å–∫–∏—Ö —Å—Ç—Ä–∞–Ω –∏ —Å—Ç–æ–ª–∏—Ü">
    <meta property="og:type" content="website">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a24;
            --bg-glass: rgba(18, 18, 26, 0.85);
            --text-primary: #f0f0f5;
            --text-secondary: #a0a0b0;
            --text-muted: #606070;
            --accent: #6366f1;
            --accent-light: #818cf8;
            --accent-glow: rgba(99, 102, 241, 0.3);
            --success: #22c55e;
            --warning: #f59e0b;
            --border: rgba(255, 255, 255, 0.08);
            --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            --sidebar-w: 360px;
            --radius: 12px
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
            height: 100dvh
        }

        .app {
            display: flex;
            height: 100vh;
            height: 100dvh
        }

        .sidebar {
            width: var(--sidebar-w);
            min-width: var(--sidebar-w);
            height: 100%;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            z-index: 1000
        }

        .header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), transparent);
            backdrop-filter: blur(10px)
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px
        }

        .logo {
            font-size: 1.2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px
        }

        .lang-switch {
            display: flex;
            gap: 4px
        }

        .lang-btn {
            padding: 6px 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-muted);
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s
        }

        .lang-btn:hover,
        .lang-btn.active {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent)
        }

        .subtitle {
            font-size: 0.8rem;
            color: var(--text-muted)
        }

        .controls {
            padding: 12px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: 10px
        }

        .search {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-primary);
            font-size: 0.875rem;
            font-family: inherit;
            outline: none;
            transition: all 0.2s
        }

        .search:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow)
        }

        .search::placeholder {
            color: var(--text-muted)
        }

        .action-btns {
            display: flex;
            gap: 8px
        }

        .action-btn {
            flex: 1;
            padding: 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px
        }

        .action-btn:hover {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent)
        }

        .action-btn.quiz-active {
            background: var(--success);
            border-color: var(--success);
            color: #fff
        }

        .list-wrap {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0
        }

        .list-wrap::-webkit-scrollbar {
            width: 6px
        }

        .list-wrap::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px
        }

        .country-list {
            list-style: none;
            counter-reset: c
        }

        .country-item {
            counter-increment: c;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: flex-start;
            gap: 12px
        }

        .country-item::before {
            content: counter(c);
            min-width: 26px;
            height: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-muted);
            transition: all 0.2s
        }

        .country-item:hover {
            background: var(--bg-tertiary)
        }

        .country-item:hover::before,
        .country-item.active::before {
            background: var(--accent);
            color: #fff
        }

        .country-item.active {
            background: linear-gradient(90deg, var(--accent-glow), transparent)
        }

        .country-item.studied .country-name::after {
            content: '‚úì';
            margin-left: 8px;
            color: var(--success);
            font-size: 0.8rem
        }

        .country-info {
            flex: 1;
            min-width: 0
        }

        .country-name {
            font-size: 0.85rem;
            font-weight: 500;
            transition: color 0.2s
        }

        .country-item:hover .country-name,
        .country-item.active .country-name {
            color: var(--accent-light)
        }

        .country-capital {
            font-size: 0.72rem;
            color: var(--text-muted);
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s
        }

        .country-item.active .country-capital,
        .country-item:hover .country-capital {
            opacity: 1;
            max-height: 30px;
            margin-top: 4px
        }

        .country-capital::before {
            content: '‚òÖ ';
            color: var(--accent)
        }

        .footer {
            padding: 16px 20px;
            border-top: 1px solid var(--border);
            background: var(--bg-tertiary)
        }

        .stats {
            display: flex;
            justify-content: space-between
        }

        .stat {
            text-align: center
        }

        .stat-val {
            font-weight: 700;
            color: var(--accent-light);
            font-size: 1.1rem
        }

        .stat-lbl {
            color: var(--text-muted);
            font-size: 0.7rem;
            margin-top: 2px
        }

        .timer {
            margin-top: 12px;
            padding: 10px;
            background: var(--bg-secondary);
            border-radius: 8px;
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-secondary)
        }

        .timer span {
            font-weight: 700;
            color: var(--accent-light);
            font-family: monospace
        }

        .map-wrap {
            flex: 1;
            position: relative;
            background: var(--bg-primary)
        }

        #map {
            width: 100%;
            height: 100%;
            background: #0d1117
        }

        .leaflet-container {
            background: #0d1117 !important;
            font-family: 'Inter', sans-serif !important
        }

        .leaflet-control-zoom {
            border: none !important;
            box-shadow: var(--shadow) !important
        }

        .leaflet-control-zoom a {
            background: var(--bg-secondary) !important;
            color: var(--text-primary) !important;
            border: 1px solid var(--border) !important;
            width: 36px !important;
            height: 36px !important;
            line-height: 36px !important
        }

        .leaflet-control-zoom a:hover {
            background: var(--bg-tertiary) !important;
            color: var(--accent-light) !important
        }

        .leaflet-control-zoom-in {
            border-radius: 8px 8px 0 0 !important
        }

        .leaflet-control-zoom-out {
            border-radius: 0 0 8px 8px !important
        }

        .leaflet-popup-content-wrapper {
            background: var(--bg-secondary) !important;
            border: 1px solid var(--border) !important;
            border-radius: var(--radius) !important;
            box-shadow: var(--shadow) !important
        }

        .leaflet-popup-content {
            margin: 12px 16px !important;
            color: var(--text-primary) !important;
            text-align: center
        }

        .leaflet-popup-tip {
            background: var(--bg-secondary) !important
        }

        .popup-country {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 4px
        }

        .popup-capital {
            font-size: 1rem;
            font-weight: 600
        }

        .quiz-prompt {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px 24px;
            z-index: 1001;
            text-align: center;
            box-shadow: var(--shadow);
            display: none
        }

        .quiz-prompt.show {
            display: block;
            animation: fadeIn 0.3s
        }

        .quiz-prompt h3 {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 8px
        }

        .quiz-prompt p {
            font-size: 1.2rem;
            font-weight: 700
        }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 12px 24px;
            z-index: 9999;
            font-size: 0.85rem;
            opacity: 0;
            transition: opacity 0.3s
        }

        .toast.show {
            opacity: 1
        }

        .toast.success {
            border-color: var(--success)
        }

        .help-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center
        }

        .help-modal.show {
            display: flex
        }

        .help-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
            max-width: 400px;
            width: 90%
        }

        .help-content h2 {
            margin-bottom: 16px;
            font-size: 1.1rem
        }

        .help-content dl {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 8px 16px;
            font-size: 0.85rem
        }

        .help-content dt {
            color: var(--accent-light);
            font-family: monospace;
            background: var(--bg-tertiary);
            padding: 4px 8px;
            border-radius: 4px
        }

        .help-content dd {
            color: var(--text-secondary)
        }

        .help-close {
            margin-top: 20px;
            width: 100%;
            padding: 12px;
            background: var(--accent);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-weight: 600;
            cursor: pointer
        }

        .loading {
            position: fixed;
            inset: 0;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s
        }

        .loading.hide {
            opacity: 0;
            pointer-events: none
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite
        }

        @keyframes spin {
            to {
                transform: rotate(360deg)
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-10px)
            }

            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0)
            }
        }

        .mobile-toggle {
            display: none;
            position: fixed;
            top: 16px;
            left: 16px;
            width: 48px;
            height: 48px;
            border-radius: 14px;
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            color: var(--text-primary);
            border: 1px solid var(--border);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 2002;
            font-size: 1.2rem;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), background 0.3s;
        }

        .mobile-toggle:active {
            transform: scale(0.9);
        }

        .mobile-toggle.open {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .mobile-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .mobile-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        @media(max-width:768px) {
            .mobile-toggle {
                display: flex;
            }

            .mobile-overlay {
                display: block;
            }

            .sidebar {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                width: 100%;
                z-index: 2001;
                height: 85vh;
                border-right: none;
                border-top: 1px solid var(--border);
                border-radius: 20px 20px 0 0;
                transform: translateY(calc(100% - 56px));
                transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1);
                box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.4);
            }

            .sidebar.open {
                transform: translateY(0);
            }

            .sidebar::before {
                content: '';
                position: absolute;
                top: 8px;
                left: 50%;
                transform: translateX(-50%);
                width: 40px;
                height: 4px;
                background: var(--text-muted);
                border-radius: 2px;
                opacity: 0.5;
            }

            /* Compact header on mobile */
            .header {
                padding: 20px 16px 12px;
                border-bottom: none;
            }

            .header-top {
                margin-bottom: 0;
            }

            .logo {
                font-size: 1rem;
            }

            .subtitle {
                display: none;
            }

            .lang-btn {
                padding: 6px 10px;
                font-size: 0.7rem;
                min-width: 36px;
            }

            /* Compact controls */
            .controls {
                padding: 8px 16px 12px;
                gap: 8px;
            }

            .search {
                padding: 10px 14px;
                font-size: 0.9rem;
                border-radius: 10px;
            }

            .action-btns {
                gap: 6px;
            }

            .action-btn {
                padding: 8px 10px;
                min-height: 40px;
                font-size: 0.75rem;
                border-radius: 8px;
            }

            .action-btn span {
                display: none;
            }

            /* Maximize list visibility */
            .list-wrap {
                flex: 1;
                padding: 4px 0;
            }

            .country-item {
                padding: 12px 16px;
                min-height: 48px;
                gap: 10px;
            }

            .country-item::before {
                min-width: 22px;
                height: 22px;
                font-size: 0.65rem;
            }

            .country-name {
                font-size: 0.9rem;
            }

            .country-capital {
                font-size: 0.7rem;
            }

            /* Compact footer */
            .footer {
                padding: 10px 16px;
                border-top: 1px solid var(--border);
            }

            .stats {
                gap: 16px;
            }

            .stat-val {
                font-size: 1rem;
            }

            .stat-lbl {
                font-size: 0.65rem;
            }

            .timer {
                display: none;
            }

            .map-wrap {
                position: fixed;
                inset: 0;
            }

            .quiz-prompt {
                top: 16px;
                bottom: auto;
                left: 16px;
                right: 16px;
                transform: none;
                width: auto;
                max-width: calc(100% - 32px);
                padding: 12px 16px;
            }

            .quiz-prompt h3 {
                font-size: 0.7rem;
                margin-bottom: 4px;
            }

            .quiz-prompt p {
                font-size: 1rem;
            }

            .leaflet-control-zoom a {
                width: 40px !important;
                height: 40px !important;
                line-height: 40px !important;
                font-size: 1.1rem !important;
            }
        }

        @keyframes pulse-country {

            0%,
            100% {
                filter: brightness(1);
            }

            50% {
                filter: brightness(1.3);
            }
        }

        .country-pulse {
            animation: pulse-country 0.6s ease-out;
        }
    </style>
</head>

<body>
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>
    <div class="toast" id="toast"></div>
    <div class="help-modal" id="helpModal">
        <div class="help-content">
            <h2 id="helpTitle">‚å®Ô∏è –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏</h2>
            <dl>
                <dt>‚Üë / ‚Üì</dt>
                <dd id="hNav">–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å–ø–∏—Å–∫—É</dd>
                <dt>/</dt>
                <dd id="hSearch">–ü–æ–∏—Å–∫</dd>
                <dt>R</dt>
                <dd id="hRandom">–°–ª—É—á–∞–π–Ω–∞—è —Å—Ç—Ä–∞–Ω–∞</dd>
                <dt>Q</dt>
                <dd id="hQuiz">–†–µ–∂–∏–º –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã</dd>
                <dt>?</dt>
                <dd id="hHelp">–°–ø—Ä–∞–≤–∫–∞</dd>
                <dt>Esc</dt>
                <dd id="hReset">–°–±—Ä–æ—Å –≤—ã–±–æ—Ä–∞</dd>
            </dl>
            <button class="help-close" id="helpClose">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
    <div class="quiz-prompt" id="quizPrompt">
        <h3 id="quizLabel">–ù–∞–π–¥–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–µ:</h3>
        <p id="quizCountry"></p>
    </div>
    <button class="mobile-toggle" id="mobileToggle">‚ò∞</button>
    <div class="mobile-overlay" id="mobileOverlay"></div>
    <div class="app">
        <aside class="sidebar" id="sidebar">
            <header class="header">
                <div class="header-top">
                    <div class="logo">üó∫Ô∏è <span id="logoText">EuroContour</span></div>
                    <div class="lang-switch">
                        <button class="lang-btn active" data-lang="ru">RU</button>
                        <button class="lang-btn" data-lang="en">EN</button>
                        <button class="lang-btn" data-lang="kz">“ö–ó</button>
                    </div>
                </div>
                <p class="subtitle" id="subtitleText">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —É—á–µ–±–Ω–∞—è –∫–∞—Ä—Ç–∞ –ï–≤—Ä–æ–ø—ã</p>
            </header>
            <div class="controls">
                <input type="text" class="search" id="search" placeholder="–ü–æ–∏—Å–∫ —Å—Ç—Ä–∞–Ω..." autocomplete="off">
                <div class="action-btns">
                    <button class="action-btn" id="randomBtn" title="–°–ª—É—á–∞–π–Ω–∞—è —Å—Ç—Ä–∞–Ω–∞">üé≤ <span
                            id="randomText">–°–ª—É—á–∞–π–Ω–∞—è</span></button>
                    <button class="action-btn" id="quizBtn" title="–†–µ–∂–∏–º –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã">üéØ <span
                            id="quizText">–í–∏–∫—Ç–æ—Ä–∏–Ω–∞</span></button>
                    <button class="action-btn" id="resetBtn" title="–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å">üîÑ</button>
                </div>
            </div>
            <div class="list-wrap">
                <ol class="country-list" id="countryList"></ol>
            </div>
            <footer class="footer">
                <div class="stats">
                    <div class="stat">
                        <div class="stat-val" id="totalStat">0</div>
                        <div class="stat-lbl" id="totalLabel">–°—Ç—Ä–∞–Ω—ã</div>
                    </div>
                    <div class="stat">
                        <div class="stat-val" id="studiedStat">0</div>
                        <div class="stat-lbl" id="studiedLabel">–ò–∑—É—á–µ–Ω–æ</div>
                    </div>
                    <div class="stat">
                        <div class="stat-val" id="progressStat">0%</div>
                        <div class="stat-lbl" id="progressLabel">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
                    </div>
                </div>
                <div class="timer" id="timerBox"><span id="timerLabel">–í—Ä–µ–º—è:</span> <span id="timer">00:00</span></div>
            </footer>
        </aside>
        <main class="map-wrap">
            <div id="map"></div>
        </main>
    </div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script>
        const TRANSLATIONS = {
            ru: { title: "–ö–æ–Ω—Ç—É—Ä–Ω–∞—è –∫–∞—Ä—Ç–∞ –ï–≤—Ä–æ–ø—ã", subtitle: "–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —É—á–µ–±–Ω–∞—è –∫–∞—Ä—Ç–∞ –ï–≤—Ä–æ–ø—ã", search: "–ü–æ–∏—Å–∫ —Å—Ç—Ä–∞–Ω...", random: "–°–ª—É—á–∞–π–Ω–∞—è", quiz: "–í–∏–∫—Ç–æ—Ä–∏–Ω–∞", total: "–°—Ç—Ä–∞–Ω—ã", studied: "–ò–∑—É—á–µ–Ω–æ", progress: "–ü—Ä–æ–≥—Ä–µ—Å—Å", time: "–í—Ä–µ–º—è", find: "–ù–∞–π–¥–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–µ:", correct: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ!", wrong: "–ù–µ–≤–µ—Ä–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë!", reset: "–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω", help: "–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏", close: "–ó–∞–∫—Ä—ã—Ç—å", nav: "–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å–ø–∏—Å–∫—É", searchKey: "–ü–æ–∏—Å–∫", randomKey: "–°–ª—É—á–∞–π–Ω–∞—è —Å—Ç—Ä–∞–Ω–∞", quizKey: "–†–µ–∂–∏–º –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã", helpKey: "–°–ø—Ä–∞–≤–∫–∞", resetKey: "–°–±—Ä–æ—Å –≤—ã–±–æ—Ä–∞", capital: "–°—Ç–æ–ª–∏—Ü–∞" },
            en: { title: "Europe Contour Map", subtitle: "Interactive Study Map of Europe", search: "Search countries...", random: "Random", quiz: "Quiz", total: "Countries", studied: "Studied", progress: "Progress", time: "Time", find: "Find on the map:", correct: "Correct!", wrong: "Wrong. Try again!", reset: "Progress reset", help: "Keyboard Shortcuts", close: "Close", nav: "Navigate list", searchKey: "Search", randomKey: "Random country", quizKey: "Quiz mode", helpKey: "Help", resetKey: "Reset selection", capital: "Capital" },
            kz: { title: "–ï—É—Ä–æ–ø–∞ –∫–æ–Ω—Ç—É—Ä–ª—ã“õ –∫–∞—Ä—Ç–∞—Å—ã", subtitle: "–ï—É—Ä–æ–ø–∞–Ω—ã“£ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤—Ç—ñ –æ“õ—É –∫–∞—Ä—Ç–∞—Å—ã", search: "–ï–ª–¥–µ—Ä–¥—ñ —ñ–∑–¥–µ—É...", random: "–ö–µ–∑–¥–µ–π—Å–æ“õ", quiz: "–í–∏–∫—Ç–æ—Ä–∏–Ω–∞", total: "–ï–ª–¥–µ—Ä", studied: "–ó–µ—Ä—Ç—Ç–µ–ª–≥–µ–Ω", progress: "“Æ–ª–≥–µ—Ä—ñ–º", time: "–£–∞“õ—ã—Ç", find: "–ö–∞—Ä—Ç–∞–¥–∞–Ω —Ç–∞–±—ã“£—ã–∑:", correct: "–î“±—Ä—ã—Å!", wrong: "“ö–∞—Ç–µ. “ö–∞–π—Ç–∞–ª–∞–ø –∫”©—Ä—ñ“£—ñ–∑!", reset: "“Æ–ª–≥–µ—Ä—ñ–º “õ–∞–ª–ø—ã–Ω–∞ –∫–µ–ª—Ç—ñ—Ä—ñ–ª–¥—ñ", help: "–ü–µ—Ä–Ω–µ–ª–µ—Ä", close: "–ñ–∞–±—É", nav: "–¢—ñ–∑—ñ–º–¥—ñ —à–∞—Ä–ª–∞—É", searchKey: "–Ü–∑–¥–µ—É", randomKey: "–ö–µ–∑–¥–µ–π—Å–æ“õ –µ–ª", quizKey: "–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ —Ä–µ–∂–∏–º—ñ", helpKey: "–ê–Ω—ã“õ—Ç–∞–º–∞", resetKey: "–¢–∞“£–¥–∞—É–¥—ã “õ–∞–ª–ø—ã–Ω–∞ –∫–µ–ª—Ç—ñ—Ä—É", capital: "–ê—Å—Ç–∞–Ω–∞" }
        };
        const COUNTRIES = {
            "Albania": { en: "Albania", ru: "–ê–ª–±–∞–Ω–∏—è", kz: "–ê–ª–±–∞–Ω–∏—è", cap: { en: "Tirana", ru: "–¢–∏—Ä–∞–Ω–∞", kz: "–¢–∏—Ä–∞–Ω–∞" }, coords: [41.33, 19.82] },
            "Andorra": { en: "Andorra", ru: "–ê–Ω–¥–æ—Ä—Ä–∞", kz: "–ê–Ω–¥–æ—Ä—Ä–∞", cap: { en: "Andorra la Vella", ru: "–ê–Ω–¥–æ—Ä—Ä–∞-–ª–∞-–í–µ–ª—å—è", kz: "–ê–Ω–¥–æ—Ä—Ä–∞-–ª–∞-–í–µ–ª—å—è" }, coords: [42.51, 1.52] },
            "Armenia": { en: "Armenia", ru: "–ê—Ä–º–µ–Ω–∏—è", kz: "–ê—Ä–º–µ–Ω–∏—è", cap: { en: "Yerevan", ru: "–ï—Ä–µ–≤–∞–Ω", kz: "–ï—Ä–µ–≤–∞–Ω" }, coords: [40.18, 44.5] },
            "Austria": { en: "Austria", ru: "–ê–≤—Å—Ç—Ä–∏—è", kz: "–ê–≤—Å—Ç—Ä–∏—è", cap: { en: "Vienna", ru: "–í–µ–Ω–∞", kz: "–í–µ–Ω–∞" }, coords: [48.21, 16.37] },
            "Azerbaijan": { en: "Azerbaijan", ru: "–ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω", kz: "”ò–∑—ñ—Ä–±–∞–π–∂–∞–Ω", cap: { en: "Baku", ru: "–ë–∞–∫—É", kz: "–ë–∞–∫—É" }, coords: [40.41, 49.87] },
            "Belarus": { en: "Belarus", ru: "–ë–µ–ª–∞—Ä—É—Å—å", kz: "–ë–µ–ª–∞—Ä—É—Å—å", cap: { en: "Minsk", ru: "–ú–∏–Ω—Å–∫", kz: "–ú–∏–Ω—Å–∫" }, coords: [53.9, 27.56] },
            "Belgium": { en: "Belgium", ru: "–ë–µ–ª—å–≥–∏—è", kz: "–ë–µ–ª—å–≥–∏—è", cap: { en: "Brussels", ru: "–ë—Ä—é—Å—Å–µ–ª—å", kz: "–ë—Ä—é—Å—Å–µ–ª—å" }, coords: [50.85, 4.35] },
            "Bosnia and Herzegovina": { en: "Bosnia and Herzegovina", ru: "–ë–æ—Å–Ω–∏—è –∏ –ì–µ—Ä—Ü–µ–≥–æ–≤–∏–Ω–∞", kz: "–ë–æ—Å–Ω–∏—è –∂”ô–Ω–µ –ì–µ—Ä—Ü–µ–≥–æ–≤–∏–Ω–∞", cap: { en: "Sarajevo", ru: "–°–∞—Ä–∞–µ–≤–æ", kz: "–°–∞—Ä–∞–µ–≤–æ" }, coords: [43.86, 18.41] },
            "Bulgaria": { en: "Bulgaria", ru: "–ë–æ–ª–≥–∞—Ä–∏—è", kz: "–ë–æ–ª–≥–∞—Ä–∏—è", cap: { en: "Sofia", ru: "–°–æ—Ñ–∏—è", kz: "–°–æ—Ñ–∏—è" }, coords: [42.7, 23.32] },
            "Croatia": { en: "Croatia", ru: "–•–æ—Ä–≤–∞—Ç–∏—è", kz: "–•–æ—Ä–≤–∞—Ç–∏—è", cap: { en: "Zagreb", ru: "–ó–∞–≥—Ä–µ–±", kz: "–ó–∞–≥—Ä–µ–±" }, coords: [45.82, 15.98] },
            "Cyprus": { en: "Cyprus", ru: "–ö–∏–ø—Ä", kz: "–ö–∏–ø—Ä", cap: { en: "Nicosia", ru: "–ù–∏–∫–æ—Å–∏—è", kz: "–ù–∏–∫–æ—Å–∏—è" }, coords: [35.19, 33.38] },
            "Czech Republic": { en: "Czech Republic", ru: "–ß–µ—Ö–∏—è", kz: "–ß–µ—Ö–∏—è", cap: { en: "Prague", ru: "–ü—Ä–∞–≥–∞", kz: "–ü—Ä–∞–≥–∞" }, coords: [50.08, 14.44] },
            "Denmark": { en: "Denmark", ru: "–î–∞–Ω–∏—è", kz: "–î–∞–Ω–∏—è", cap: { en: "Copenhagen", ru: "–ö–æ–ø–µ–Ω–≥–∞–≥–µ–Ω", kz: "–ö–æ–ø–µ–Ω–≥–∞–≥–µ–Ω" }, coords: [55.68, 12.57] },
            "Estonia": { en: "Estonia", ru: "–≠—Å—Ç–æ–Ω–∏—è", kz: "–≠—Å—Ç–æ–Ω–∏—è", cap: { en: "Tallinn", ru: "–¢–∞–ª–ª–∏–Ω", kz: "–¢–∞–ª–ª–∏–Ω" }, coords: [59.44, 24.75] },
            "Finland": { en: "Finland", ru: "–§–∏–Ω–ª—è–Ω–¥–∏—è", kz: "–§–∏–Ω–ª—è–Ω–¥–∏—è", cap: { en: "Helsinki", ru: "–•–µ–ª—å—Å–∏–Ω–∫–∏", kz: "–•–µ–ª—å—Å–∏–Ω–∫–∏" }, coords: [60.17, 24.94] },
            "France": { en: "France", ru: "–§—Ä–∞–Ω—Ü–∏—è", kz: "–§—Ä–∞–Ω—Ü–∏—è", cap: { en: "Paris", ru: "–ü–∞—Ä–∏–∂", kz: "–ü–∞—Ä–∏–∂" }, coords: [48.86, 2.35] },
            "Georgia": { en: "Georgia", ru: "–ì—Ä—É–∑–∏—è", kz: "–ì—Ä—É–∑–∏—è", cap: { en: "Tbilisi", ru: "–¢–±–∏–ª–∏—Å–∏", kz: "–¢–±–∏–ª–∏—Å–∏" }, coords: [41.72, 44.83] },
            "Germany": { en: "Germany", ru: "–ì–µ—Ä–º–∞–Ω–∏—è", kz: "–ì–µ—Ä–º–∞–Ω–∏—è", cap: { en: "Berlin", ru: "–ë–µ—Ä–ª–∏–Ω", kz: "–ë–µ—Ä–ª–∏–Ω" }, coords: [52.52, 13.41] },
            "Greece": { en: "Greece", ru: "–ì—Ä–µ—Ü–∏—è", kz: "–ì—Ä–µ–∫–∏—è", cap: { en: "Athens", ru: "–ê—Ñ–∏–Ω—ã", kz: "–ê—Ñ–∏–Ω—ã" }, coords: [37.98, 23.73] },
            "Hungary": { en: "Hungary", ru: "–í–µ–Ω–≥—Ä–∏—è", kz: "–í–µ–Ω–≥—Ä–∏—è", cap: { en: "Budapest", ru: "–ë—É–¥–∞–ø–µ—à—Ç", kz: "–ë—É–¥–∞–ø–µ—à—Ç" }, coords: [47.5, 19.04] },
            "Iceland": { en: "Iceland", ru: "–ò—Å–ª–∞–Ω–¥–∏—è", kz: "–ò—Å–ª–∞–Ω–¥–∏—è", cap: { en: "Reykjavik", ru: "–†–µ–π–∫—å—è–≤–∏–∫", kz: "–†–µ–π–∫—å—è–≤–∏–∫" }, coords: [64.15, -21.94] },
            "Ireland": { en: "Ireland", ru: "–ò—Ä–ª–∞–Ω–¥–∏—è", kz: "–ò—Ä–ª–∞–Ω–¥–∏—è", cap: { en: "Dublin", ru: "–î—É–±–ª–∏–Ω", kz: "–î—É–±–ª–∏–Ω" }, coords: [53.35, -6.26] },
            "Italy": { en: "Italy", ru: "–ò—Ç–∞–ª–∏—è", kz: "–ò—Ç–∞–ª–∏—è", cap: { en: "Rome", ru: "–†–∏–º", kz: "–†–∏–º" }, coords: [41.9, 12.5] },
            "Kazakhstan": { en: "Kazakhstan", ru: "–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω", kz: "“ö–∞–∑–∞“õ—Å—Ç–∞–Ω", cap: { en: "Astana", ru: "–ê—Å—Ç–∞–Ω–∞", kz: "–ê—Å—Ç–∞–Ω–∞" }, coords: [51.16, 71.47] },
            "Kosovo": { en: "Kosovo", ru: "–ö–æ—Å–æ–≤–æ", kz: "–ö–æ—Å–æ–≤–æ", cap: { en: "Pristina", ru: "–ü—Ä–∏—à—Ç–∏–Ω–∞", kz: "–ü—Ä–∏—à—Ç–∏–Ω–∞" }, coords: [42.66, 21.17] },
            "Latvia": { en: "Latvia", ru: "–õ–∞—Ç–≤–∏—è", kz: "–õ–∞—Ç–≤–∏—è", cap: { en: "Riga", ru: "–†–∏–≥–∞", kz: "–†–∏–≥–∞" }, coords: [56.95, 24.11] },
            "Liechtenstein": { en: "Liechtenstein", ru: "–õ–∏—Ö—Ç–µ–Ω—à—Ç–µ–π–Ω", kz: "–õ–∏—Ö—Ç–µ–Ω—à—Ç–µ–π–Ω", cap: { en: "Vaduz", ru: "–í–∞–¥—É—Ü", kz: "–í–∞–¥—É—Ü" }, coords: [47.14, 9.52] },
            "Lithuania": { en: "Lithuania", ru: "–õ–∏—Ç–≤–∞", kz: "–õ–∏—Ç–≤–∞", cap: { en: "Vilnius", ru: "–í–∏–ª—å–Ω—é—Å", kz: "–í–∏–ª—å–Ω—é—Å" }, coords: [54.69, 25.28] },
            "Luxembourg": { en: "Luxembourg", ru: "–õ—é–∫—Å–µ–º–±—É—Ä–≥", kz: "–õ—é–∫—Å–µ–º–±—É—Ä–≥", cap: { en: "Luxembourg City", ru: "–õ—é–∫—Å–µ–º–±—É—Ä–≥", kz: "–õ—é–∫—Å–µ–º–±—É—Ä–≥" }, coords: [49.61, 6.13] },
            "Malta": { en: "Malta", ru: "–ú–∞–ª—å—Ç–∞", kz: "–ú–∞–ª—å—Ç–∞", cap: { en: "Valletta", ru: "–í–∞–ª–ª–µ—Ç—Ç–∞", kz: "–í–∞–ª–ª–µ—Ç—Ç–∞" }, coords: [35.9, 14.51] },
            "Moldova": { en: "Moldova", ru: "–ú–æ–ª–¥–æ–≤–∞", kz: "–ú–æ–ª–¥–æ–≤–∞", cap: { en: "Chi»ôinƒÉu", ru: "–ö–∏—à–∏–Ω—ë–≤", kz: "–ö–∏—à–∏–Ω–µ–≤" }, coords: [47.01, 28.86] },
            "Monaco": { en: "Monaco", ru: "–ú–æ–Ω–∞–∫–æ", kz: "–ú–æ–Ω–∞–∫–æ", cap: { en: "Monaco", ru: "–ú–æ–Ω–∞–∫–æ", kz: "–ú–æ–Ω–∞–∫–æ" }, coords: [43.74, 7.42] },
            "Montenegro": { en: "Montenegro", ru: "–ß–µ—Ä–Ω–æ–≥–æ—Ä–∏—è", kz: "–ß–µ—Ä–Ω–æ–≥–æ—Ä–∏—è", cap: { en: "Podgorica", ru: "–ü–æ–¥–≥–æ—Ä–∏—Ü–∞", kz: "–ü–æ–¥–≥–æ—Ä–∏—Ü–∞" }, coords: [42.43, 19.26] },
            "Netherlands": { en: "Netherlands", ru: "–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã", kz: "–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã", cap: { en: "Amsterdam", ru: "–ê–º—Å—Ç–µ—Ä–¥–∞–º", kz: "–ê–º—Å—Ç–µ—Ä–¥–∞–º" }, coords: [52.37, 4.9] },
            "North Macedonia": { en: "North Macedonia", ru: "–°–µ–≤–µ—Ä–Ω–∞—è –ú–∞–∫–µ–¥–æ–Ω–∏—è", kz: "–°–æ–ª—Ç“Ø—Å—Ç—ñ–∫ –ú–∞–∫–µ–¥–æ–Ω–∏—è", cap: { en: "Skopje", ru: "–°–∫–æ–ø—å–µ", kz: "–°–∫–æ–ø—å–µ" }, coords: [42, 21.43] },
            "Norway": { en: "Norway", ru: "–ù–æ—Ä–≤–µ–≥–∏—è", kz: "–ù–æ—Ä–≤–µ–≥–∏—è", cap: { en: "Oslo", ru: "–û—Å–ª–æ", kz: "–û—Å–ª–æ" }, coords: [59.91, 10.75] },
            "Poland": { en: "Poland", ru: "–ü–æ–ª—å—à–∞", kz: "–ü–æ–ª—å—à–∞", cap: { en: "Warsaw", ru: "–í–∞—Ä—à–∞–≤–∞", kz: "–í–∞—Ä—à–∞–≤–∞" }, coords: [52.23, 21.01] },
            "Portugal": { en: "Portugal", ru: "–ü–æ—Ä—Ç—É–≥–∞–ª–∏—è", kz: "–ü–æ—Ä—Ç—É–≥–∞–ª–∏—è", cap: { en: "Lisbon", ru: "–õ–∏—Å—Å–∞–±–æ–Ω", kz: "–õ–∏—Å—Å–∞–±–æ–Ω" }, coords: [38.72, -9.14] },
            "Romania": { en: "Romania", ru: "–†—É–º—ã–Ω–∏—è", kz: "–†—É–º—ã–Ω–∏—è", cap: { en: "Bucharest", ru: "–ë—É—Ö–∞—Ä–µ—Å—Ç", kz: "–ë—É—Ö–∞—Ä–µ—Å—Ç" }, coords: [44.43, 26.1] },
            "Russia": { en: "Russia", ru: "–†–æ—Å—Å–∏—è", kz: "–†–µ—Å–µ–π", cap: { en: "Moscow", ru: "–ú–æ—Å–∫–≤–∞", kz: "–ú”ô—Å–∫–µ—É" }, coords: [55.76, 37.62] },
            "San Marino": { en: "San Marino", ru: "–°–∞–Ω-–ú–∞—Ä–∏–Ω–æ", kz: "–°–∞–Ω-–ú–∞—Ä–∏–Ω–æ", cap: { en: "San Marino", ru: "–°–∞–Ω-–ú–∞—Ä–∏–Ω–æ", kz: "–°–∞–Ω-–ú–∞—Ä–∏–Ω–æ" }, coords: [43.94, 12.46] },
            "Serbia": { en: "Serbia", ru: "–°–µ—Ä–±–∏—è", kz: "–°–µ—Ä–±–∏—è", cap: { en: "Belgrade", ru: "–ë–µ–ª–≥—Ä–∞–¥", kz: "–ë–µ–ª–≥—Ä–∞–¥" }, coords: [44.79, 20.45] },
            "Slovakia": { en: "Slovakia", ru: "–°–ª–æ–≤–∞–∫–∏—è", kz: "–°–ª–æ–≤–∞–∫–∏—è", cap: { en: "Bratislava", ru: "–ë—Ä–∞—Ç–∏—Å–ª–∞–≤–∞", kz: "–ë—Ä–∞—Ç–∏—Å–ª–∞–≤–∞" }, coords: [48.15, 17.11] },
            "Slovenia": { en: "Slovenia", ru: "–°–ª–æ–≤–µ–Ω–∏—è", kz: "–°–ª–æ–≤–µ–Ω–∏—è", cap: { en: "Ljubljana", ru: "–õ—é–±–ª—è–Ω–∞", kz: "–õ—é–±–ª—è–Ω–∞" }, coords: [46.06, 14.51] },
            "Spain": { en: "Spain", ru: "–ò—Å–ø–∞–Ω–∏—è", kz: "–ò—Å–ø–∞–Ω–∏—è", cap: { en: "Madrid", ru: "–ú–∞–¥—Ä–∏–¥", kz: "–ú–∞–¥—Ä–∏–¥" }, coords: [40.42, -3.7] },
            "Sweden": { en: "Sweden", ru: "–®–≤–µ—Ü–∏—è", kz: "–®–≤–µ—Ü–∏—è", cap: { en: "Stockholm", ru: "–°—Ç–æ–∫–≥–æ–ª—å–º", kz: "–°—Ç–æ–∫–≥–æ–ª—å–º" }, coords: [59.33, 18.07] },
            "Switzerland": { en: "Switzerland", ru: "–®–≤–µ–π—Ü–∞—Ä–∏—è", kz: "–®–≤–µ–π—Ü–∞—Ä–∏—è", cap: { en: "Bern", ru: "–ë–µ—Ä–Ω", kz: "–ë–µ—Ä–Ω" }, coords: [46.95, 7.45] },
            "Turkey": { en: "Turkey", ru: "–¢—É—Ä—Ü–∏—è", kz: "–¢“Ø—Ä–∫–∏—è", cap: { en: "Ankara", ru: "–ê–Ω–∫–∞—Ä–∞", kz: "–ê–Ω–∫–∞—Ä–∞" }, coords: [39.93, 32.86] },
            "Ukraine": { en: "Ukraine", ru: "–£–∫—Ä–∞–∏–Ω–∞", kz: "–£–∫—Ä–∞–∏–Ω–∞", cap: { en: "Kyiv", ru: "–ö–∏–µ–≤", kz: "–ö–∏–µ–≤" }, coords: [50.45, 30.52] },
            "United Kingdom": { en: "United Kingdom", ru: "–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è", kz: "“∞–ª—ã–±—Ä–∏—Ç–∞–Ω–∏—è", cap: { en: "London", ru: "–õ–æ–Ω–¥–æ–Ω", kz: "–õ–æ–Ω–¥–æ–Ω" }, coords: [51.51, -0.13] },
            "Faroe Islands": { en: "Faroe Islands", ru: "–§–∞—Ä–µ—Ä—Å–∫–∏–µ –æ—Å—Ç—Ä–æ–≤–∞", kz: "–§–∞—Ä–µ—Ä –∞—Ä–∞–ª–¥–∞—Ä—ã", cap: { en: "T√≥rshavn", ru: "–¢–æ—Ä—Å—Ö–∞–≤–Ω", kz: "–¢–æ—Ä—Å—Ö–∞–≤–Ω" }, coords: [62.01, -6.77] },
            "Palestine": { en: "Palestine", ru: "–ü–∞–ª–µ—Å—Ç–∏–Ω–∞", kz: "–ü–∞–ª–µ—Å—Ç–∏–Ω–∞", cap: { en: "Ramallah", ru: "–†–∞–º–∞–ª–ª–∞", kz: "–†–∞–º–∞–ª–ª–∞" }, coords: [31.89, 35.20] },
            "Holy See (Vatican City)": { en: "Vatican City", ru: "–í–∞—Ç–∏–∫–∞–Ω", kz: "–í–∞—Ç–∏–∫–∞–Ω", cap: { en: "Vatican City", ru: "–í–∞—Ç–∏–∫–∞–Ω", kz: "–í–∞—Ç–∏–∫–∞–Ω" }, coords: [41.9, 12.45] }
        };
        let map, geoLayer, layers = {}, active = null, studied = new Set(), marker = null, countries = [], lang = 'ru', quizMode = false, quizTarget = null, timerStart = Date.now(), timerInterval;
        const GEOJSON_URL = 'https://raw.githubusercontent.com/leakyMirror/map-of-europe/master/GeoJSON/europe.geojson';
        const $ = id => document.getElementById(id);
        const t = key => TRANSLATIONS[lang][key] || key;
        const getName = key => COUNTRIES[key] ? COUNTRIES[key][lang] : key;
        const getCap = key => COUNTRIES[key]?.cap ? COUNTRIES[key].cap[lang] : '-';
        const getCoords = key => COUNTRIES[key]?.coords || null;

        function updateUI() {
            document.documentElement.lang = lang;
            $('subtitleText').textContent = t('subtitle');
            $('search').placeholder = t('search');
            $('randomText').textContent = t('random');
            $('quizText').textContent = t('quiz');
            $('totalLabel').textContent = t('total');
            $('studiedLabel').textContent = t('studied');
            $('progressLabel').textContent = t('progress');
            $('timerLabel').textContent = t('time') + ':';
            $('quizLabel').textContent = t('find');
            $('helpTitle').textContent = '‚å®Ô∏è ' + t('help');
            $('helpClose').textContent = t('close');
            $('hNav').textContent = t('nav');
            $('hSearch').textContent = t('searchKey');
            $('hRandom').textContent = t('randomKey');
            $('hQuiz').textContent = t('quizKey');
            $('hHelp').textContent = t('helpKey');
            $('hReset').textContent = t('resetKey');
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.toggle('active', b.dataset.lang === lang));
            buildList();
        }
        function setLang(l) { lang = l; localStorage.setItem('euroLang', l); updateUI(); }
        function toast(msg, type = '') { const el = $('toast'); el.textContent = msg; el.className = 'toast show' + (type ? ' ' + type : ''); setTimeout(() => el.classList.remove('show'), 2000); }
        function updateStats() {
            $('totalStat').textContent = countries.length;
            $('studiedStat').textContent = studied.size;
            $('progressStat').textContent = countries.length ? Math.round(studied.size / countries.length * 100) + '%' : '0%';
        }
        function updateTimer() { const s = Math.floor((Date.now() - timerStart) / 1000); const m = Math.floor(s / 60); $('timer').textContent = String(m).padStart(2, '0') + ':' + String(s % 60).padStart(2, '0'); }
        function buildList() {
            const list = $('countryList'); list.innerHTML = '';
            const sorted = [...countries].sort((a, b) => getName(a.properties.NAME).localeCompare(getName(b.properties.NAME), lang));
            sorted.forEach(f => {
                const key = f.properties.NAME, name = getName(key), cap = getCap(key);
                const li = document.createElement('li');
                li.className = 'country-item' + (studied.has(key) ? ' studied' : '');
                li.dataset.key = key;
                li.innerHTML = `<div class="country-info"><div class="country-name">${name}</div><div class="country-capital">${cap}</div></div>`;
                li.addEventListener('click', () => {
                    // Use selectFromList if available (handles mobile auto-close), else fall back to select
                    if (window.selectFromList) window.selectFromList(key);
                    else select(key);
                });
                li.addEventListener('mouseenter', () => { if (layers[key] && active !== key) { layers[key].setStyle(hoverStyle()); layers[key].bringToFront(); } });
                li.addEventListener('mouseleave', () => { if (layers[key] && active !== key) layers[key].setStyle(defaultStyle()); });
                list.appendChild(li);
            });
        }
        function defaultStyle() { return { fillColor: '#1e1e2e', weight: 1.5, opacity: 1, color: '#3a3a4a', fillOpacity: 0.9 }; }
        function hoverStyle() { return { fillColor: '#2a2a3e', weight: 2, color: '#6366f1', fillOpacity: 0.95 }; }
        function activeStyle() { return { fillColor: '#4a4a6a', weight: 2.5, color: '#818cf8', fillOpacity: 1 }; }
        function select(key) {
            if (quizMode) {
                if (key === quizTarget) { toast(t('correct'), 'success'); studied.add(key); nextQuiz(); }
                else { toast(t('wrong')); return; }
            }
            if (active && layers[active]) layers[active].setStyle(defaultStyle());
            document.querySelectorAll('.country-item.active').forEach(el => el.classList.remove('active'));
            if (marker) { map.removeLayer(marker); marker = null; }
            active = key;
            const layer = layers[key];
            if (layer) {
                layer.setStyle(activeStyle()); layer.bringToFront();
                map.flyToBounds(layer.getBounds(), { padding: [50, 50], maxZoom: 7, duration: 0.6 });
                const coords = getCoords(key);
                if (coords) {
                    marker = L.circleMarker(coords, { radius: 8, fillColor: '#6366f1', color: '#fff', weight: 2, fillOpacity: 0.9 }).addTo(map);
                    marker.bindPopup(`<div class="popup-country">${getName(key)}</div><div class="popup-capital">‚òÖ ${getCap(key)}</div>`).openPopup();
                }
            }
            const li = document.querySelector(`.country-item[data-key="${key}"]`);
            if (li) {
                li.classList.add('active');
                li.scrollIntoView({ behavior: 'smooth', block: 'center' });
                // Add visual feedback pulse
                li.classList.add('country-pulse');
                li.addEventListener('animationend', () => li.classList.remove('country-pulse'), { once: true });
            }
            studied.add(key);
            document.querySelectorAll(`.country-item[data-key="${key}"]`).forEach(el => el.classList.add('studied'));
            localStorage.setItem('euroStudied', JSON.stringify([...studied]));
            updateStats();
        }
        function randomCountry() {
            const unstudied = countries.filter(c => !studied.has(c.properties.NAME));
            const pool = unstudied.length ? unstudied : countries;
            const pick = pool[Math.floor(Math.random() * pool.length)];
            select(pick.properties.NAME);
        }
        function toggleQuiz() {
            quizMode = !quizMode;
            $('quizBtn').classList.toggle('quiz-active', quizMode);
            if (quizMode) nextQuiz(); else $('quizPrompt').classList.remove('show');
        }
        function nextQuiz() {
            const unstudied = countries.filter(c => !studied.has(c.properties.NAME));
            if (!unstudied.length) { quizMode = false; $('quizBtn').classList.remove('quiz-active'); $('quizPrompt').classList.remove('show'); toast(t('correct')); return; }
            quizTarget = unstudied[Math.floor(Math.random() * unstudied.length)].properties.NAME;
            $('quizCountry').textContent = getName(quizTarget);
            $('quizPrompt').classList.add('show');
        }
        function resetProgress() {
            if (!confirm('Reset progress?')) return;
            studied.clear(); localStorage.removeItem('euroStudied');
            document.querySelectorAll('.country-item.studied').forEach(el => el.classList.remove('studied'));
            updateStats(); toast(t('reset'));
        }
        async function loadGeo() {
            try {
                const res = await fetch(GEOJSON_URL);
                const data = await res.json();
                countries = data.features.filter(f => f.properties.NAME && !['French Guiana', 'Reunion', 'Martinique', 'Guadeloupe'].includes(f.properties.NAME));
                countries.forEach(f => { if (f.properties.NAME === 'Israel') f.properties.NAME = 'Palestine'; });
                geoLayer = L.geoJSON(countries, {
                    style: defaultStyle, onEachFeature: (f, l) => {
                        const key = f.properties.NAME; layers[key] = l;
                        l.on({ mouseover: () => { if (active !== key) { l.setStyle(hoverStyle()); l.bringToFront(); } }, mouseout: () => { if (active !== key) l.setStyle(defaultStyle()); }, click: () => select(key) });
                    }
                }).addTo(map);
                const saved = localStorage.getItem('euroStudied');
                if (saved) try { studied = new Set(JSON.parse(saved)); } catch { }
                updateUI(); updateStats();
                $('loading').classList.add('hide');
            } catch (e) { console.error(e); alert('Failed to load map data'); }
        }
        function initMap() {
            map = L.map('map', { center: [54, 15], zoom: 4, minZoom: 3, maxZoom: 10, maxBounds: L.latLngBounds([34, -25], [72, 45]).pad(0.5), maxBoundsViscosity: 0.8 });
            map.zoomControl.setPosition('bottomright');
            loadGeo();
        }
        function initEvents() {
            const isMobile = () => window.innerWidth <= 768;
            const toggleSidebar = (open) => {
                const s = $('sidebar');
                const overlay = $('mobileOverlay');
                const toggle = $('mobileToggle');
                if (open === undefined) open = !s.classList.contains('open');
                s.classList.toggle('open', open);
                overlay.classList.toggle('show', open);
                toggle.classList.toggle('open', open);
                toggle.textContent = open ? '‚úï' : '‚ò∞';
            };

            document.querySelectorAll('.lang-btn').forEach(b => b.addEventListener('click', () => setLang(b.dataset.lang)));
            $('randomBtn').addEventListener('click', () => {
                randomCountry();
                if (isMobile()) toggleSidebar(false);
            });
            $('quizBtn').addEventListener('click', () => {
                toggleQuiz();
                if (isMobile() && quizMode) toggleSidebar(false);
            });
            $('resetBtn').addEventListener('click', resetProgress);
            $('mobileToggle').addEventListener('click', () => toggleSidebar());
            $('mobileOverlay').addEventListener('click', () => toggleSidebar(false));
            $('helpClose').addEventListener('click', () => $('helpModal').classList.remove('show'));

            // Wrap select function to auto-close sidebar on mobile
            const originalSelect = select;
            window.selectFromList = (key) => {
                originalSelect(key);
                if (isMobile()) {
                    setTimeout(() => toggleSidebar(false), 300);
                }
            };

            let debounce;
            $('search').addEventListener('input', e => {
                clearTimeout(debounce); debounce = setTimeout(() => {
                    const q = e.target.value.toLowerCase();
                    document.querySelectorAll('.country-item').forEach(el => {
                        const key = el.dataset.key, name = getName(key).toLowerCase(), cap = getCap(key).toLowerCase();
                        el.style.display = (name.includes(q) || cap.includes(q)) ? 'flex' : 'none';
                    });
                }, 150);
            });

            document.addEventListener('keydown', e => {
                if (e.target.tagName === 'INPUT') return;
                const items = [...document.querySelectorAll('.country-item')].filter(el => el.style.display !== 'none');
                const idx = items.findIndex(el => el.dataset.key === active);
                if (e.key === 'ArrowDown' || e.key === 'j') { e.preventDefault(); const next = idx < items.length - 1 ? idx + 1 : 0; select(items[next].dataset.key); }
                else if (e.key === 'ArrowUp' || e.key === 'k') { e.preventDefault(); const prev = idx > 0 ? idx - 1 : items.length - 1; select(items[prev].dataset.key); }
                else if (e.key === '/') { e.preventDefault(); $('search').focus(); }
                else if (e.key === 'r' || e.key === 'R') randomCountry();
                else if (e.key === 'q' || e.key === 'Q') toggleQuiz();
                else if (e.key === '?') $('helpModal').classList.add('show');
                else if (e.key === 'Escape') {
                    if (active && layers[active]) layers[active].setStyle(defaultStyle());
                    if (marker) { map.removeLayer(marker); marker = null; }
                    active = null;
                    document.querySelectorAll('.country-item.active').forEach(el => el.classList.remove('active'));
                    map.flyTo([54, 15], 4, { duration: 0.5 });
                    $('helpModal').classList.remove('show');
                    if (isMobile()) toggleSidebar(false);
                }
            });

            // Improved touch gestures with velocity detection
            const sidebar = $('sidebar');
            let touchStartY = 0;
            let touchStartTime = 0;
            let isDragging = false;

            sidebar.addEventListener('touchstart', e => {
                touchStartY = e.touches[0].clientY;
                touchStartTime = Date.now();
                isDragging = false;
            }, { passive: true });

            sidebar.addEventListener('touchmove', e => {
                const dy = touchStartY - e.touches[0].clientY;
                if (Math.abs(dy) > 15) isDragging = true;
            }, { passive: true });

            sidebar.addEventListener('touchend', e => {
                if (!isDragging) return;
                const dy = touchStartY - e.changedTouches[0].clientY;
                const dt = Date.now() - touchStartTime;
                const velocity = Math.abs(dy) / dt;

                // Use velocity for quick swipes, or distance for slower drags
                if (velocity > 0.5 || Math.abs(dy) > 50) {
                    toggleSidebar(dy > 0);
                }
            }, { passive: true });

            timerInterval = setInterval(updateTimer, 1000);
        }
        document.addEventListener('DOMContentLoaded', () => {
            lang = localStorage.getItem('euroLang') || 'ru';
            initMap(); initEvents();
        });
    </script>
</body>

</html>–π